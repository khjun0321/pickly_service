# ğŸ—ºï¸ Pickly v8.5 ê°œë°œ ë¡œë“œë§µ

> **í”„ë¡œì íŠ¸**: Pickly Service
> **ë²„ì „**: v8.5 â†’ v9.0
> **ê¸°ê°„**: 2025-11 ~ 2026-02 (4ê°œì›”)
> **ìµœì¢… ìˆ˜ì •**: 2025-10-31

---

## ğŸ“Š í˜„ì¬ ìƒíƒœ (2025-10-31)

### âœ… ì™„ë£Œëœ ì‘ì—…
- Flutter UI ë ˆì´ì–´ ë¶„ë¦¬ (`features/` vs `contexts/`)
- Repository Pattern ê¸°ë³¸ êµ¬í˜„
- Admin Material UI ê¸°ë°˜ CRUD
- Supabase v8.1 ë§ˆì´ê·¸ë ˆì´ì…˜ ì ìš©
- LH ê³µê³  Edge Function êµ¬í˜„
- Realtime ë™ê¸°í™” ê¸°ë³¸ ì„¤ì •

### âš ï¸ ì§„í–‰ ì¤‘
- `benefit` vs `benefits` í´ë” í†µí•©
- D-Day ê³„ì‚° ê¸°ëŠ¥ êµ¬í˜„
- Admin UI í•„í„°/ì •ë ¬ ê°œì„ 

### âŒ ë¯¸êµ¬í˜„
- SH(ì„œìš¸ì£¼íƒ) API ì—°ë™
- ë³µì§€ë¡œ(ë³´ê±´ë³µì§€ë¶€) API ì—°ë™
- íŒŒì¼ ì²¨ë¶€ ê¸°ëŠ¥
- SSO ì¤€ë¹„ êµ¬ì¡°
- ì—°ë ¹ëŒ€/ê³µê³ ìœ í˜• Admin UI

---

## ğŸ¯ Phase 1: ê¸´ê¸‰ ë²„ê·¸ ìˆ˜ì • (1-2ì£¼)

**ëª©í‘œ**: PRD v8.5 í•µì‹¬ ìš”êµ¬ì‚¬í•­ ì¤€ìˆ˜
**ê¸°ê°„**: 2025-11-01 ~ 2025-11-15

### 1.1 Repository Layer ì•ˆì •í™”

**ì‘ì—… ë‚´ìš©**:
```bash
# 1. benefit vs benefits í´ë” í†µí•©
contexts/benefit/
  â”œâ”€â”€ repositories/
  â”‚   â”œâ”€â”€ announcement_repository.dart       # ê³µê³  ì „ìš©
  â”‚   â”œâ”€â”€ category_repository.dart           # ì¹´í…Œê³ ë¦¬ ì „ìš©
  â”‚   â””â”€â”€ unified_benefit_repository.dart    # í†µí•© ë ˆí¬ì§€í† ë¦¬
  â”œâ”€â”€ providers/
  â”‚   â”œâ”€â”€ announcement_provider.dart         # features/benefit ìš©
  â”‚   â””â”€â”€ announcements_provider.dart        # features/benefits ìš©
  â””â”€â”€ adapters/
      â”œâ”€â”€ detail_adapter.dart                # ìƒì„¸ í™”ë©´ ì–´ëŒ‘í„°
      â””â”€â”€ list_adapter.dart                  # ë¦¬ìŠ¤íŠ¸ í™”ë©´ ì–´ëŒ‘í„°
```

**ì™„ë£Œ ê¸°ì¤€**:
- [ ] ë‘ í´ë” ëª¨ë‘ ë™ì¼í•œ Repository ì‚¬ìš©
- [ ] Provider ë ˆì´ì–´ì—ì„œë§Œ ì–´ëŒ‘í„° ì ìš©
- [ ] UI íŒŒì¼ ìˆ˜ì • ì—†ì´ í†µí•©
- [ ] ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ í†µê³¼

### 1.2 D-Day ê³„ì‚° ê¸°ëŠ¥

**ì‘ì—… ë‚´ìš©**:

**1ë‹¨ê³„: Supabase RPC í•¨ìˆ˜**
```sql
-- migrations/20251101000001_add_dday_function.sql
CREATE OR REPLACE FUNCTION get_announcement_dday(p_announcement_id UUID)
RETURNS INTEGER AS $$
DECLARE
    v_deadline DATE;
    v_today DATE;
BEGIN
    SELECT deadline_date INTO v_deadline
    FROM announcements
    WHERE id = p_announcement_id;

    IF v_deadline IS NULL THEN
        RETURN NULL;
    END IF;

    v_today := CURRENT_DATE;
    RETURN (v_deadline - v_today);
END;
$$ LANGUAGE plpgsql STABLE;

-- Viewë¡œ D-Day ìë™ ê³„ì‚°
CREATE OR REPLACE VIEW announcements_with_dday AS
SELECT
    a.*,
    CASE
        WHEN a.deadline_date IS NULL THEN NULL
        WHEN a.deadline_date < CURRENT_DATE THEN -1
        ELSE (a.deadline_date - CURRENT_DATE)
    END AS days_remaining,
    CASE
        WHEN a.deadline_date IS NULL THEN 'ongoing'
        WHEN a.deadline_date < CURRENT_DATE THEN 'closed'
        WHEN (a.deadline_date - CURRENT_DATE) <= 7 THEN 'urgent'
        ELSE 'open'
    END AS deadline_status
FROM announcements a;
```

**2ë‹¨ê³„: Flutter Repository**
```dart
// contexts/benefit/repositories/announcement_repository.dart
extension AnnouncementDDay on Announcement {
    int? get daysRemaining {
        if (deadlineDate == null) return null;
        return deadlineDate!.difference(DateTime.now()).inDays;
    }

    String get deadlineStatusText {
        final days = daysRemaining;
        if (days == null) return 'ìƒì‹œ ëª¨ì§‘';
        if (days < 0) return 'ë§ˆê°';
        if (days == 0) return 'ì˜¤ëŠ˜ ë§ˆê°';
        if (days <= 7) return 'D-$days';
        return 'ëª¨ì§‘ ì¤‘';
    }

    DeadlineStatus get deadlineStatus {
        final days = daysRemaining;
        if (days == null) return DeadlineStatus.ongoing;
        if (days < 0) return DeadlineStatus.closed;
        if (days <= 7) return DeadlineStatus.urgent;
        return DeadlineStatus.open;
    }
}

enum DeadlineStatus {
    ongoing,  // ìƒì‹œ ëª¨ì§‘
    open,     // ëª¨ì§‘ ì¤‘
    urgent,   // ë§ˆê° ì„ë°• (7ì¼ ì´ë‚´)
    closed    // ë§ˆê°
}
```

**3ë‹¨ê³„: Admin UI**
```tsx
// src/components/announcements/DeadlineChip.tsx
export function DeadlineChip({ announcement }: { announcement: Announcement }) {
    const daysRemaining = useMemo(() => {
        if (!announcement.deadline_date) return null;
        const deadline = new Date(announcement.deadline_date);
        const today = new Date();
        return Math.ceil((deadline.getTime() - today.getTime()) / (1000 * 60 * 60 * 24));
    }, [announcement.deadline_date]);

    if (daysRemaining === null) {
        return <Chip label="ìƒì‹œ ëª¨ì§‘" color="default" />;
    }

    if (daysRemaining < 0) {
        return <Chip label="ë§ˆê°" color="error" />;
    }

    if (daysRemaining === 0) {
        return <Chip label="ì˜¤ëŠ˜ ë§ˆê°" color="error" />;
    }

    if (daysRemaining <= 7) {
        return <Chip label={`D-${daysRemaining}`} color="warning" />;
    }

    return <Chip label={`D-${daysRemaining}`} color="success" />;
}

// src/pages/benefits/BenefitCategoryPage.tsx
const columns = [
    {
        field: 'deadline',
        headerName: 'ë§ˆê°ì¼',
        width: 150,
        renderCell: (params) => <DeadlineChip announcement={params.row} />
    },
    // ...
];
```

**ì™„ë£Œ ê¸°ì¤€**:
- [ ] RPC í•¨ìˆ˜ ìƒì„± ë° í…ŒìŠ¤íŠ¸
- [ ] Flutter Extension êµ¬í˜„
- [ ] Admin Chip ì»´í¬ë„ŒíŠ¸ êµ¬í˜„
- [ ] ì •ë ¬/í•„í„°ë§ ê¸°ëŠ¥ ì¶”ê°€

### 1.3 Admin UI í•„í„°/ì •ë ¬ ê°œì„ 

**ì‘ì—… ë‚´ìš©**:
```tsx
// src/pages/benefits/BenefitCategoryPage.tsx
export function BenefitCategoryPage() {
    const [filters, setFilters] = useState({
        status: 'all',
        region: 'all',
        orderBy: 'created_at'
    });

    const { data: announcements } = useQuery({
        queryKey: ['announcements', categoryId, filters],
        queryFn: async () => {
            let query = supabase
                .from('announcements')
                .select('*')
                .eq('category_id', categoryId);

            // ìƒíƒœ í•„í„°
            if (filters.status !== 'all') {
                query = query.eq('status', filters.status);
            }

            // ì§€ì—­ í•„í„°
            if (filters.region !== 'all') {
                query = query.eq('region', filters.region);
            }

            // ì •ë ¬
            const isDesc = filters.orderBy === 'views_count' || filters.orderBy === 'created_at';
            query = query.order(filters.orderBy, { ascending: !isDesc });

            const { data } = await query;
            return data;
        }
    });

    return (
        <Box>
            {/* í•„í„° UI */}
            <Stack direction="row" spacing={2} mb={2}>
                <FormControl>
                    <InputLabel>ìƒíƒœ</InputLabel>
                    <Select
                        value={filters.status}
                        onChange={(e) => setFilters({ ...filters, status: e.target.value })}
                    >
                        <MenuItem value="all">ì „ì²´</MenuItem>
                        <MenuItem value="recruiting">ëª¨ì§‘ì¤‘</MenuItem>
                        <MenuItem value="upcoming">ì˜ˆì •</MenuItem>
                        <MenuItem value="closed">ë§ˆê°</MenuItem>
                    </Select>
                </FormControl>

                <FormControl>
                    <InputLabel>ì§€ì—­</InputLabel>
                    <Select
                        value={filters.region}
                        onChange={(e) => setFilters({ ...filters, region: e.target.value })}
                    >
                        <MenuItem value="all">ì „ì²´</MenuItem>
                        <MenuItem value="ì„œìš¸">ì„œìš¸</MenuItem>
                        <MenuItem value="ê²½ê¸°">ê²½ê¸°</MenuItem>
                        {/* ... */}
                    </Select>
                </FormControl>

                <ToggleButtonGroup
                    value={filters.orderBy}
                    exclusive
                    onChange={(_, value) => setFilters({ ...filters, orderBy: value })}
                >
                    <ToggleButton value="created_at">ìµœì‹ ìˆœ</ToggleButton>
                    <ToggleButton value="views_count">ì¸ê¸°ìˆœ</ToggleButton>
                    <ToggleButton value="deadline_date">ë§ˆê°ìˆœ</ToggleButton>
                </ToggleButtonGroup>
            </Stack>

            {/* í…Œì´ë¸” */}
            <DataGrid rows={announcements} columns={columns} />
        </Box>
    );
}
```

**ì™„ë£Œ ê¸°ì¤€**:
- [ ] ìƒíƒœ í•„í„° (ëª¨ì§‘ì¤‘/ì˜ˆì •/ë§ˆê°)
- [ ] ì§€ì—­ í•„í„° (ì„œìš¸/ê²½ê¸°/...)
- [ ] ì •ë ¬ (ìµœì‹ ìˆœ/ì¸ê¸°ìˆœ/ë§ˆê°ìˆœ)
- [ ] URL ì¿¼ë¦¬ìŠ¤íŠ¸ë§ ì—°ë™

---

## ğŸš€ Phase 2: í•µì‹¬ ê¸°ëŠ¥ ì™„ì„± (2-3ì£¼)

**ëª©í‘œ**: ê³µê³µ API íŒŒì´í”„ë¼ì¸ ì™„ì„±
**ê¸°ê°„**: 2025-11-16 ~ 2025-12-08

### 2.1 SH(ì„œìš¸ì£¼íƒ) API ì—°ë™

**ì‘ì—… ë‚´ìš©**:

**1ë‹¨ê³„: Edge Function ìƒì„±**
```typescript
// functions/fetch-sh-announcements/index.ts
import { serve } from "https://deno.land/std@0.168.0/http/server.ts";
import { createClient } from '@supabase/supabase-js';

const SH_API_URL = 'https://www.i-sh.co.kr/api/notices';

serve(async (req) => {
    try {
        const supabase = createClient(
            Deno.env.get('SUPABASE_URL')!,
            Deno.env.get('SUPABASE_SERVICE_ROLE_KEY')!
        );

        // SH API í˜¸ì¶œ
        const response = await fetch(`${SH_API_URL}?page=1&size=100`, {
            headers: {
                'Accept': 'application/json',
            }
        });

        if (!response.ok) {
            throw new Error(`SH API error: ${response.statusText}`);
        }

        const data = await response.json();

        // announcements_rawì— ì €ì¥
        const rawRecords = data.items.map((item: any) => ({
            source: 'SH',
            raw_data: item,
            created_at: new Date().toISOString()
        }));

        const { error: insertError } = await supabase
            .from('announcements_raw')
            .insert(rawRecords);

        if (insertError) throw insertError;

        // ë°ì´í„° ì •ì œ í•¨ìˆ˜ í˜¸ì¶œ
        const { error: transformError } = await supabase
            .rpc('transform_sh_announcements');

        if (transformError) throw transformError;

        return new Response(
            JSON.stringify({
                success: true,
                message: `${data.items.length}ê°œì˜ SH ê³µê³ ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.`
            }),
            { headers: { 'Content-Type': 'application/json' } }
        );
    } catch (error) {
        console.error('SH API Error:', error);
        return new Response(
            JSON.stringify({ success: false, error: error.message }),
            { status: 500, headers: { 'Content-Type': 'application/json' } }
        );
    }
});
```

**2ë‹¨ê³„: Transform í•¨ìˆ˜**
```sql
-- migrations/20251116000001_sh_transform.sql
CREATE OR REPLACE FUNCTION transform_sh_announcements()
RETURNS INTEGER AS $$
DECLARE
    v_count INTEGER := 0;
    v_raw RECORD;
    v_category_id UUID;
BEGIN
    -- ì£¼ê±° ì¹´í…Œê³ ë¦¬ ID ì¡°íšŒ
    SELECT id INTO v_category_id
    FROM benefit_categories
    WHERE slug = 'housing'
    LIMIT 1;

    -- SH ì›ë³¸ ë°ì´í„° ì²˜ë¦¬
    FOR v_raw IN
        SELECT * FROM announcements_raw
        WHERE source = 'SH'
        AND NOT EXISTS (
            SELECT 1 FROM announcements
            WHERE source = 'SH'
            AND external_id = v_raw.raw_data->>'noticeId'
        )
    LOOP
        INSERT INTO announcements (
            category_id,
            source,
            external_id,
            title,
            subtitle,
            content,
            organization,
            external_url,
            region,
            deadline_date,
            application_start_date,
            application_end_date,
            status,
            is_active
        ) VALUES (
            v_category_id,
            'SH',
            v_raw.raw_data->>'noticeId',
            v_raw.raw_data->>'title',
            v_raw.raw_data->>'summary',
            v_raw.raw_data->>'content',
            'ì„œìš¸ì£¼íƒë„ì‹œê³µì‚¬',
            v_raw.raw_data->>'detailUrl',
            'ì„œìš¸',
            (v_raw.raw_data->>'deadlineDate')::DATE,
            (v_raw.raw_data->>'startDate')::TIMESTAMPTZ,
            (v_raw.raw_data->>'endDate')::TIMESTAMPTZ,
            CASE
                WHEN (v_raw.raw_data->>'deadlineDate')::DATE < CURRENT_DATE THEN 'closed'
                WHEN (v_raw.raw_data->>'startDate')::DATE > CURRENT_DATE THEN 'upcoming'
                ELSE 'recruiting'
            END,
            TRUE
        );

        v_count := v_count + 1;
    END LOOP;

    RETURN v_count;
END;
$$ LANGUAGE plpgsql;
```

**3ë‹¨ê³„: Admin UI ë²„íŠ¼ ì¶”ê°€**
```tsx
// src/pages/benefits/BenefitCategoryPage.tsx
{categorySlug === 'housing' && (
    <ButtonGroup>
        <Button
            variant="outlined"
            startIcon={<DownloadIcon />}
            onClick={() => fetchLHMutation.mutate()}
        >
            LH ê³µê³ 
        </Button>
        <Button
            variant="outlined"
            startIcon={<DownloadIcon />}
            onClick={() => fetchSHMutation.mutate()}
        >
            SH ê³µê³ 
        </Button>
    </ButtonGroup>
)}
```

**ì™„ë£Œ ê¸°ì¤€**:
- [ ] SH Edge Function êµ¬í˜„
- [ ] Transform í•¨ìˆ˜ êµ¬í˜„
- [ ] Admin UI ë²„íŠ¼ ì¶”ê°€
- [ ] ì¤‘ë³µ ë°©ì§€ ë¡œì§ í…ŒìŠ¤íŠ¸

### 2.2 ë³µì§€ë¡œ(ë³´ê±´ë³µì§€ë¶€) API ì—°ë™

**ì‘ì—… ë‚´ìš©**:
(SHì™€ ë™ì¼í•œ íŒ¨í„´, API ì—”ë“œí¬ì¸íŠ¸ë§Œ ë³€ê²½)

**ë³µì§€ë¡œ API ë§¤í•‘**:
```typescript
// functions/fetch-bokjiro-announcements/index.ts
const BOKJIRO_API_URL = 'https://www.bokjiro.go.kr/openapi/rest/gvmtWelSvc';

// ë³µì§€ ì¹´í…Œê³ ë¦¬ë³„ API í˜¸ì¶œ
const categories = [
    { code: '001', name: 'ê±´ê°•' },
    { code: '002', name: 'êµìœ¡' },
    { code: '003', name: 'ê³ ìš©' },
    // ...
];

for (const category of categories) {
    const response = await fetch(
        `${BOKJIRO_API_URL}?serviceKey=${API_KEY}&sBizCode=${category.code}`
    );
    // ...
}
```

**ì™„ë£Œ ê¸°ì¤€**:
- [ ] ë³µì§€ë¡œ Edge Function êµ¬í˜„
- [ ] ì¹´í…Œê³ ë¦¬ë³„ Transform í•¨ìˆ˜
- [ ] Admin UI ë²„íŠ¼ ì¶”ê°€
- [ ] ì¼ì¼ ìë™ ìˆ˜ì§‘ Cron ì„¤ì •

### 2.3 í†µí•© ë°ì´í„° ì •ì œ íŒŒì´í”„ë¼ì¸

**ì‘ì—… ë‚´ìš©**:
```sql
-- migrations/20251125000001_unified_transform.sql
CREATE OR REPLACE FUNCTION transform_all_announcements()
RETURNS TABLE(source TEXT, count INTEGER) AS $$
BEGIN
    RETURN QUERY
    SELECT 'LH'::TEXT, transform_lh_announcements()
    UNION ALL
    SELECT 'SH'::TEXT, transform_sh_announcements()
    UNION ALL
    SELECT 'BOKJIRO'::TEXT, transform_bokjiro_announcements();
END;
$$ LANGUAGE plpgsql;

-- Cron Job (pg_cron)
SELECT cron.schedule(
    'fetch-all-announcements',
    '0 2 * * *',  -- ë§¤ì¼ ìƒˆë²½ 2ì‹œ
    $$
    SELECT net.http_post(
        url := 'https://your-project.supabase.co/functions/v1/fetch-all-announcements',
        headers := '{"Authorization": "Bearer ' || current_setting('app.service_role_key') || '"}'::jsonb
    );
    $$
);
```

**ì™„ë£Œ ê¸°ì¤€**:
- [ ] í†µí•© Transform í•¨ìˆ˜
- [ ] Cron Job ì„¤ì •
- [ ] ì—ëŸ¬ ë¡œê¹… ì‹œìŠ¤í…œ
- [ ] Admin ëŒ€ì‹œë³´ë“œì— ìˆ˜ì§‘ í˜„í™© í‘œì‹œ

---

## ğŸ’ Phase 3: UX ê°œì„  (2-3ì£¼)

**ëª©í‘œ**: ì‚¬ìš©ì„± í–¥ìƒ ë° ë¶€ê°€ ê¸°ëŠ¥
**ê¸°ê°„**: 2025-12-09 ~ 2025-12-29

### 3.1 íŒŒì¼ ì²¨ë¶€ ê¸°ëŠ¥

**ì‘ì—… ë‚´ìš©**:

**1ë‹¨ê³„: DB ìŠ¤í‚¤ë§ˆ**
```sql
-- migrations/20251209000001_announcement_files.sql
CREATE TABLE announcement_files (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    announcement_id UUID NOT NULL REFERENCES announcements(id) ON DELETE CASCADE,
    file_name TEXT NOT NULL,
    file_path TEXT NOT NULL,
    file_size INTEGER,
    file_type TEXT,
    display_order INTEGER DEFAULT 0,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX idx_announcement_files_announcement_id
    ON announcement_files(announcement_id);

-- Storage Bucket
INSERT INTO storage.buckets (id, name, public)
VALUES ('announcement-files', 'announcement-files', true);

-- RLS Policy
CREATE POLICY "Anyone can view files"
    ON storage.objects FOR SELECT
    USING (bucket_id = 'announcement-files');

CREATE POLICY "Authenticated users can upload"
    ON storage.objects FOR INSERT
    WITH CHECK (bucket_id = 'announcement-files' AND auth.role() = 'authenticated');
```

**2ë‹¨ê³„: Flutter Repository**
```dart
// contexts/benefit/repositories/announcement_file_repository.dart
class AnnouncementFileRepository {
    final SupabaseClient _client;

    Future<List<AnnouncementFile>> getFiles(String announcementId) async {
        final response = await _client
            .from('announcement_files')
            .select()
            .eq('announcement_id', announcementId)
            .order('display_order');

        return (response as List)
            .map((json) => AnnouncementFile.fromJson(json))
            .toList();
    }

    Future<String> getFileUrl(String filePath) async {
        return _client.storage
            .from('announcement-files')
            .getPublicUrl(filePath);
    }

    Future<void> downloadFile(String filePath, String savePath) async {
        final bytes = await _client.storage
            .from('announcement-files')
            .download(filePath);

        final file = File(savePath);
        await file.writeAsBytes(bytes);
    }
}
```

**3ë‹¨ê³„: Admin UI**
```tsx
// src/components/files/FileManager.tsx
export function FileManager({ announcementId }: { announcementId: string }) {
    const [files, setFiles] = useState<File[]>([]);

    const handleUpload = async (file: File) => {
        const filePath = `${announcementId}/${Date.now()}_${file.name}`;

        // Storage ì—…ë¡œë“œ
        const { error: uploadError } = await supabase.storage
            .from('announcement-files')
            .upload(filePath, file);

        if (uploadError) throw uploadError;

        // DB ë ˆì½”ë“œ ìƒì„±
        const { error: dbError } = await supabase
            .from('announcement_files')
            .insert({
                announcement_id: announcementId,
                file_name: file.name,
                file_path: filePath,
                file_size: file.size,
                file_type: file.type
            });

        if (dbError) throw dbError;

        toast.success('íŒŒì¼ì´ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤');
    };

    return (
        <Box>
            <FileUploader onUpload={handleUpload} />
            <List>
                {files.map((file) => (
                    <ListItem key={file.id}>
                        <ListItemText
                            primary={file.file_name}
                            secondary={`${(file.file_size / 1024).toFixed(2)} KB`}
                        />
                        <IconButton onClick={() => handleDownload(file.file_path)}>
                            <DownloadIcon />
                        </IconButton>
                    </ListItem>
                ))}
            </List>
        </Box>
    );
}
```

**ì™„ë£Œ ê¸°ì¤€**:
- [ ] Storage Bucket ì„¤ì •
- [ ] Upload/Download API
- [ ] Admin íŒŒì¼ ê´€ë¦¬ UI
- [ ] Flutter íŒŒì¼ ë·°ì–´ (PDF/ì´ë¯¸ì§€)

### 3.2 ì—°ë ¹ëŒ€ ê´€ë¦¬ Admin UI

**ì‘ì—… ë‚´ìš©**:
```tsx
// src/pages/age-categories/AgeCategoriesPage.tsx
export function AgeCategoriesPage() {
    const { data: categories } = useQuery({
        queryKey: ['age-categories'],
        queryFn: async () => {
            const { data } = await supabase
                .from('age_categories')
                .select('*')
                .order('sort_order');
            return data;
        }
    });

    const updateMutation = useMutation({
        mutationFn: async ({ id, updates }) => {
            const { data } = await supabase
                .from('age_categories')
                .update(updates)
                .eq('id', id)
                .select()
                .single();
            return data;
        }
    });

    const columns: GridColDef[] = [
        { field: 'name', headerName: 'ì—°ë ¹ëŒ€ëª…', width: 150, editable: true },
        { field: 'min_age', headerName: 'ìµœì†Œ ë‚˜ì´', width: 100, editable: true },
        { field: 'max_age', headerName: 'ìµœëŒ€ ë‚˜ì´', width: 100, editable: true },
        {
            field: 'icon_url',
            headerName: 'ì•„ì´ì½˜',
            width: 100,
            renderCell: (params) => (
                <Avatar src={params.value} sx={{ width: 40, height: 40 }} />
            )
        },
        { field: 'sort_order', headerName: 'ìˆœì„œ', width: 80, editable: true },
        {
            field: 'is_active',
            headerName: 'í™œì„±í™”',
            width: 100,
            type: 'boolean',
            editable: true
        }
    ];

    return (
        <Box>
            <Typography variant="h4" gutterBottom>
                ì—°ë ¹ëŒ€ ê´€ë¦¬
            </Typography>
            <DataGrid
                rows={categories || []}
                columns={columns}
                processRowUpdate={(newRow) => {
                    updateMutation.mutate({ id: newRow.id, updates: newRow });
                    return newRow;
                }}
            />
        </Box>
    );
}
```

**ì™„ë£Œ ê¸°ì¤€**:
- [ ] CRUD ê¸°ëŠ¥
- [ ] ì•„ì´ì½˜ ì—…ë¡œë“œ
- [ ] ë“œë˜ê·¸ì•¤ë“œë¡­ ì •ë ¬
- [ ] í™œì„±í™”/ë¹„í™œì„±í™” í† ê¸€

### 3.3 ê³µê³ ìœ í˜• ê´€ë¦¬ Admin UI

**ì‘ì—… ë‚´ìš©**:
(ì—°ë ¹ëŒ€ì™€ ë™ì¼í•œ íŒ¨í„´)

**ì™„ë£Œ ê¸°ì¤€**:
- [ ] CRUD ê¸°ëŠ¥
- [ ] ìƒìœ„ ì¹´í…Œê³ ë¦¬ ì—°ê²°
- [ ] ì •ë ¬/í•„í„°ë§
- [ ] í™œì„±í™” í† ê¸€

---

## ğŸ”® Phase 4: SSO ì¤€ë¹„ ë° ìµœì í™” (1-2ì£¼)

**ëª©í‘œ**: v9.0 ëŒ€ë¹„ ê¸°ë°˜ ì‘ì—…
**ê¸°ê°„**: 2025-12-30 ~ 2026-01-12

### 4.1 Supabase Auth í™•ì¥ ì„¤ì •

**ì‘ì—… ë‚´ìš©**:

**1ë‹¨ê³„: OAuth Provider ì„¤ì •**
```sql
-- Supabase Dashboard â†’ Authentication â†’ Providers
-- Kakao Provider
{
  "client_id": "KAKAO_REST_API_KEY",
  "client_secret": "KAKAO_CLIENT_SECRET",
  "redirect_uri": "https://your-project.supabase.co/auth/v1/callback"
}

-- Naver Provider
{
  "client_id": "NAVER_CLIENT_ID",
  "client_secret": "NAVER_CLIENT_SECRET",
  "redirect_uri": "https://your-project.supabase.co/auth/v1/callback"
}
```

**2ë‹¨ê³„: Flutter OAuth ë¡œì§ (ì¤€ë¹„ë§Œ)**
```dart
// contexts/auth/repositories/auth_repository.dart
class AuthRepository {
    Future<void> signInWithKakao() async {
        // v9.0ì—ì„œ êµ¬í˜„ ì˜ˆì •
        throw UnimplementedError('SSOëŠ” v9.0ì—ì„œ ì§€ì›ë©ë‹ˆë‹¤');
    }

    Future<void> signInWithNaver() async {
        // v9.0ì—ì„œ êµ¬í˜„ ì˜ˆì •
        throw UnimplementedError('SSOëŠ” v9.0ì—ì„œ ì§€ì›ë©ë‹ˆë‹¤');
    }
}
```

**3ë‹¨ê³„: Admin RLS ê°•í™”**
```sql
-- migrations/20251230000001_rls_enhancement.sql
-- Admin ì „ìš© ì—­í•  ìƒì„±
CREATE ROLE admin_role;

-- Admin í…Œì´ë¸” ì ‘ê·¼ ì œí•œ
ALTER TABLE announcements ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Admin can do everything"
    ON announcements FOR ALL
    USING (
        EXISTS (
            SELECT 1 FROM auth.users
            WHERE id = auth.uid()
            AND raw_user_meta_data->>'role' = 'admin'
        )
    );

CREATE POLICY "Public can view published"
    ON announcements FOR SELECT
    USING (status = 'recruiting' AND is_active = true);
```

**ì™„ë£Œ ê¸°ì¤€**:
- [ ] OAuth Provider ì„¤ì •
- [ ] RLS ì •ì±… ê°•í™”
- [ ] ê¶Œí•œ ê´€ë¦¬ UI (Admin)
- [ ] SSO ë¬¸ì„œí™”

### 4.2 ì„±ëŠ¥ ìµœì í™”

**ì‘ì—… ë‚´ìš©**:

**1. DB ì¸ë±ìŠ¤ ìµœì í™”**
```sql
-- migrations/20251231000001_performance_indexes.sql
-- ë³µí•© ì¸ë±ìŠ¤
CREATE INDEX idx_announcements_category_status
    ON announcements(category_id, status)
    WHERE is_active = true;

CREATE INDEX idx_announcements_region_deadline
    ON announcements(region, deadline_date)
    WHERE status = 'recruiting';

-- ë¶€ë¶„ ì¸ë±ìŠ¤
CREATE INDEX idx_announcements_home_visible
    ON announcements(display_priority)
    WHERE is_home_visible = true;

-- Full-text ì¸ë±ìŠ¤ ìµœì í™”
CREATE INDEX idx_announcements_search_vector
    ON announcements USING GIN(search_vector);
```

**2. Admin ë²ˆë“¤ ìµœì í™”**
```typescript
// vite.config.ts
export default defineConfig({
    build: {
        rollupOptions: {
            output: {
                manualChunks: {
                    'mui': ['@mui/material', '@mui/icons-material'],
                    'react-vendor': ['react', 'react-dom', 'react-router-dom'],
                    'query': ['@tanstack/react-query']
                }
            }
        }
    }
});
```

**3. Flutter ì´ë¯¸ì§€ ìºì‹±**
```dart
// contexts/benefit/repositories/image_cache_repository.dart
class ImageCacheRepository {
    final Map<String, Uint8List> _cache = {};

    Future<Uint8List> getImage(String url) async {
        if (_cache.containsKey(url)) {
            return _cache[url]!;
        }

        final response = await http.get(Uri.parse(url));
        _cache[url] = response.bodyBytes;
        return response.bodyBytes;
    }
}
```

**ì™„ë£Œ ê¸°ì¤€**:
- [ ] DB ì¿¼ë¦¬ ì„±ëŠ¥ 10ë°° í–¥ìƒ
- [ ] Admin ì´ˆê¸° ë¡œë”© 2ì´ˆ ì´ë‚´
- [ ] Flutter ì´ë¯¸ì§€ ë¡œë”© ê°œì„ 
- [ ] Lighthouse ì ìˆ˜ 90+ (Admin)

### 4.3 ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ

**ì‘ì—… ë‚´ìš©**:
```tsx
// src/pages/dashboard/Dashboard.tsx
export function Dashboard() {
    const { data: stats } = useQuery({
        queryKey: ['dashboard-stats'],
        queryFn: async () => {
            const [announcements, views, errors] = await Promise.all([
                supabase.from('announcements').select('count'),
                supabase.from('announcements').select('views_count'),
                supabase.from('error_logs').select('count')
            ]);

            return {
                totalAnnouncements: announcements.count,
                totalViews: views.data?.reduce((sum, a) => sum + a.views_count, 0),
                errorCount: errors.count
            };
        },
        refetchInterval: 60000  // 1ë¶„ë§ˆë‹¤ ê°±ì‹ 
    });

    return (
        <Grid container spacing={3}>
            <Grid item xs={12} md={4}>
                <StatCard
                    title="ì´ ê³µê³  ìˆ˜"
                    value={stats?.totalAnnouncements || 0}
                    icon={<AnnouncementIcon />}
                />
            </Grid>
            <Grid item xs={12} md={4}>
                <StatCard
                    title="ì´ ì¡°íšŒìˆ˜"
                    value={stats?.totalViews || 0}
                    icon={<VisibilityIcon />}
                />
            </Grid>
            <Grid item xs={12} md={4}>
                <StatCard
                    title="ì—ëŸ¬ ìˆ˜"
                    value={stats?.errorCount || 0}
                    icon={<ErrorIcon />}
                />
            </Grid>

            {/* ìµœê·¼ ê³µê³  ì°¨íŠ¸ */}
            <Grid item xs={12}>
                <AnnouncementChart />
            </Grid>
        </Grid>
    );
}
```

**ì™„ë£Œ ê¸°ì¤€**:
- [ ] ëŒ€ì‹œë³´ë“œ í†µê³„ ì¹´ë“œ
- [ ] ê³µê³  ì¶”ì´ ì°¨íŠ¸
- [ ] ì—ëŸ¬ ë¡œê·¸ ë·°ì–´
- [ ] API ìˆ˜ì§‘ í˜„í™©

---

## ğŸ“… íƒ€ì„ë¼ì¸ ìš”ì•½

| Phase | ê¸°ê°„ | ì£¼ìš” ì‘ì—… | ì™„ë£Œìœ¨ ëª©í‘œ |
|-------|------|---------|-----------|
| **Phase 1** | 11/01 ~ 11/15 (2ì£¼) | ê¸´ê¸‰ ë²„ê·¸ ìˆ˜ì •, D-Day, í•„í„° | v8.5 ì¤€ìˆ˜ 100% |
| **Phase 2** | 11/16 ~ 12/08 (3ì£¼) | SH/ë³µì§€ë¡œ API, íŒŒì´í”„ë¼ì¸ | ê³µê³µ API 100% |
| **Phase 3** | 12/09 ~ 12/29 (3ì£¼) | íŒŒì¼ ì²¨ë¶€, Admin UI ì™„ì„± | UX ê°œì„  100% |
| **Phase 4** | 12/30 ~ 01/12 (2ì£¼) | SSO ì¤€ë¹„, ì„±ëŠ¥ ìµœì í™” | v9.0 ì¤€ë¹„ 100% |
| **Total** | **10ì£¼** | v8.5 ì™„ì„± + v9.0 ê¸°ë°˜ | **100%** |

---

## ğŸ¯ ë§ˆì¼ìŠ¤í†¤

### M1: v8.5.1 Release (2025-11-15)
- [ ] Repository Layer ì•ˆì •í™”
- [ ] D-Day ê³„ì‚° ê¸°ëŠ¥
- [ ] Admin í•„í„°/ì •ë ¬ ê°œì„ 

### M2: v8.5.2 Release (2025-12-08)
- [ ] SH API ì—°ë™
- [ ] ë³µì§€ë¡œ API ì—°ë™
- [ ] í†µí•© ë°ì´í„° íŒŒì´í”„ë¼ì¸

### M3: v8.5.3 Release (2025-12-29)
- [ ] íŒŒì¼ ì²¨ë¶€ ê¸°ëŠ¥
- [ ] ì—°ë ¹ëŒ€/ê³µê³ ìœ í˜• Admin UI
- [ ] UX ê°œì„  ì™„ë£Œ

### M4: v9.0 Beta (2026-01-12)
- [ ] SSO OAuth ì„¤ì •
- [ ] ì„±ëŠ¥ ìµœì í™”
- [ ] ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ

---

## ğŸ“Š ì„±ê³µ ì§€í‘œ (KPI)

### ê¸°ìˆ  ì§€í‘œ
- **PRD v8.5 ì¤€ìˆ˜ìœ¨**: 100%
- **Admin ë¡œë”© ì†ë„**: < 2ì´ˆ
- **Flutter ë¹Œë“œ í¬ê¸°**: < 30MB
- **DB ì¿¼ë¦¬ í‰ê·  ì‘ë‹µ**: < 100ms
- **Lighthouse ì ìˆ˜**: > 90

### ë¹„ì¦ˆë‹ˆìŠ¤ ì§€í‘œ
- **ì¼ì¼ ê³µê³  ìˆ˜ì§‘**: 100+ ê±´
- **Admin ì‘ì—… íš¨ìœ¨**: 50% í–¥ìƒ
- **ë²„ê·¸ ë°œìƒë¥ **: < 5%
- **API ì •í™•ë„**: > 95%

---

## ğŸš¨ ë¦¬ìŠ¤í¬ ê´€ë¦¬

### ë†’ì€ ìš°ì„ ìˆœìœ„ ë¦¬ìŠ¤í¬

| ë¦¬ìŠ¤í¬ | ì˜í–¥ë„ | ì™„í™” ì „ëµ |
|--------|--------|---------|
| ê³µê³µ API ë³€ê²½ | ë†’ìŒ | Transform í•¨ìˆ˜ë¡œ ì¶”ìƒí™” |
| UI ë³€ê²½ ê¸ˆì§€ ì œì•½ | ì¤‘ê°„ | Repository íŒ¨í„´ ì² ì € ì¤€ìˆ˜ |
| Supabase ì„±ëŠ¥ | ì¤‘ê°„ | ì¸ë±ìŠ¤ ìµœì í™”, ìºì‹± |
| ì¼ì • ì§€ì—° | ë†’ìŒ | Phaseë³„ ë§ˆì¼ìŠ¤í†¤ ê²€ì¦ |

### ëŒ€ì‘ ë°©ì•ˆ
- **ê³µê³µ API ì¥ì• **: ìºì‹œëœ ë°ì´í„° ì œê³µ, ì—ëŸ¬ ë¡œê¹…
- **ì¼ì • ì§€ì—°**: Phase 3 ì¼ë¶€ v9.0 ì´ì›” ê°€ëŠ¥
- **ì„±ëŠ¥ ì´ìŠˆ**: Supabase Edge Functions í™œìš©

---

## âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸

### Phase 1 ì™„ë£Œ ì¡°ê±´
- [ ] `benefit` vs `benefits` í†µí•© ì™„ë£Œ
- [ ] D-Day RPC/UI êµ¬í˜„
- [ ] Admin í•„í„°/ì •ë ¬ 3ì¢…
- [ ] ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ 90% ì»¤ë²„ë¦¬ì§€

### Phase 2 ì™„ë£Œ ì¡°ê±´
- [ ] SH Edge Function ë°°í¬
- [ ] ë³µì§€ë¡œ Edge Function ë°°í¬
- [ ] Cron Job ì„¤ì •
- [ ] 100+ ê³µê³  ìë™ ìˆ˜ì§‘ ê²€ì¦

### Phase 3 ì™„ë£Œ ì¡°ê±´
- [ ] íŒŒì¼ ì—…ë¡œë“œ/ë‹¤ìš´ë¡œë“œ
- [ ] ì—°ë ¹ëŒ€ CRUD
- [ ] ê³µê³ ìœ í˜• CRUD
- [ ] Admin UX ê°œì„  ì™„ë£Œ

### Phase 4 ì™„ë£Œ ì¡°ê±´
- [ ] OAuth Provider ì„¤ì •
- [ ] RLS ì •ì±… ê°•í™”
- [ ] ì„±ëŠ¥ ì§€í‘œ ë‹¬ì„±
- [ ] v9.0 ì¤€ë¹„ ë¬¸ì„œ

---

**ìµœì¢… ìˆ˜ì •**: 2025-10-31
**ì‘ì„±ì**: Claude Code Agent
**ë²„ì „**: v8.5 Roadmap v1.0
