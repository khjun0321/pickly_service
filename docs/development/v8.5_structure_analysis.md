# ğŸ“Š Pickly v8.5 í”„ë¡œì íŠ¸ êµ¬ì¡° ë¶„ì„ ë³´ê³ ì„œ

> **ë¶„ì„ ì¼ì**: 2025-10-31
> **ê¸°ì¤€ ë¬¸ì„œ**: PRD v8.5 Master Final
> **ë¶„ì„ì**: Claude Code Agent

---

## ğŸ“Œ Executive Summary

Pickly í”„ë¡œì íŠ¸ëŠ” PRD v8.5 Master Finalì—ì„œ ì •ì˜í•œ "Flutter UI ê³ ì •, Repository Layer ë¶„ë¦¬, Admin/Supabase í™•ì¥" ì „ëµì„ ëŒ€ì²´ë¡œ ì¤€ìˆ˜í•˜ê³  ìˆìŠµë‹ˆë‹¤. í˜„ì¬ í”„ë¡œì íŠ¸ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ìƒíƒœì…ë‹ˆë‹¤:

### âœ… ì¤€ìˆ˜ ì‚¬í•­
- Flutter UI (`/apps/pickly_mobile/lib/features/`) ë¶„ë¦¬ ì™„ë£Œ
- Repository Pattern (`/contexts/`) êµ¬í˜„ ì™„ë£Œ
- Admin Material UI (`/apps/pickly_admin/`) ê¸°ë°˜ êµ¬ì¶•
- Supabase ë§ˆì´ê·¸ë ˆì´ì…˜ v8.1 ì ìš© ì™„ë£Œ

### âš ï¸ ê°œì„  í•„ìš” ì‚¬í•­
- `benefit` vs `benefits` í´ë” ì¤‘ë³µ ì¡´ì¬
- Edge Function êµ¬í˜„ ë¶€ì¡± (LHë§Œ ì¡´ì¬)
- SSO ì¤€ë¹„ êµ¬ì¡° ë¯¸êµ¬ì¶•
- Realtime ë™ê¸°í™” í…ŒìŠ¤íŠ¸ í•„ìš”

---

## ğŸ—ï¸ 1. ì „ì²´ ì•„í‚¤í…ì²˜ ë¶„ì„

### 1.1 í´ë” êµ¬ì¡° í˜„í™©

```
pickly_service/
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ pickly_mobile/          # Flutter ì•± (ë³€ê²½ ê¸ˆì§€)
â”‚   â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”‚   â”œâ”€â”€ features/       # âŒ UI ë ˆì´ì–´ (ì ˆëŒ€ ë³€ê²½ ê¸ˆì§€)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ admin/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ benefit/    # âš ï¸ ì‹ ê·œ í´ë”
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ benefits/   # âš ï¸ ê¸°ì¡´ í´ë” (ì¤‘ë³µ)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ home/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ housing/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ onboarding/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ profile/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ settings/
â”‚   â”‚   â”‚   â””â”€â”€ contexts/       # âœ… ë°ì´í„° ë ˆì´ì–´ (ë³€ê²½ ê°€ëŠ¥)
â”‚   â”‚   â”‚       â”œâ”€â”€ benefit/    # âœ… Repository êµ¬í˜„
â”‚   â”‚   â”‚       â”œâ”€â”€ housing/    # âœ… LH API ì—°ë™
â”‚   â”‚   â”‚       â””â”€â”€ user/       # âœ… ì‚¬ìš©ì ë°ì´í„°
â”‚   â””â”€â”€ pickly_admin/           # Admin React ì•± (ë³€ê²½ ê°€ëŠ¥)
â”‚       â””â”€â”€ src/
â”‚           â”œâ”€â”€ api/            # âœ… Supabase API í˜¸ì¶œ
â”‚           â”œâ”€â”€ components/     # âœ… Material UI ì»´í¬ë„ŒíŠ¸
â”‚           â”œâ”€â”€ pages/          # âœ… í™”ë©´ë³„ ê´€ë¦¬
â”‚           â””â”€â”€ types/          # âœ… TypeScript íƒ€ì…
â”œâ”€â”€ backend/
â”‚   â””â”€â”€ supabase/
â”‚       â”œâ”€â”€ migrations/         # âœ… DB ìŠ¤í‚¤ë§ˆ ê´€ë¦¬
â”‚       â”œâ”€â”€ functions/          # âš ï¸ Edge Function (LHë§Œ)
â”‚       â””â”€â”€ seed.sql            # âœ… ì´ˆê¸° ë°ì´í„°
â””â”€â”€ packages/
    â””â”€â”€ pickly_design_system/   # âŒ ë³€ê²½ ê¸ˆì§€
```

### 1.2 PRD v8.5 ì¤€ìˆ˜ë„ ë¶„ì„

| ê³„ì¸µ | PRD ìš”êµ¬ì‚¬í•­ | í˜„ì¬ ìƒíƒœ | ì¤€ìˆ˜ìœ¨ |
|------|-------------|----------|--------|
| **Flutter UI** | ì ˆëŒ€ ë³€ê²½ ê¸ˆì§€ | âœ… ë¶„ë¦¬ë¨ (`features/`) | 100% |
| **Repository Layer** | ë°ì´í„° ë§¤í•‘ ì „ë‹´ | âœ… êµ¬í˜„ë¨ (`contexts/`) | 95% |
| **Admin (Material)** | CRUD + ì»¤ìŠ¤í„°ë§ˆì´ì§• | âœ… MUI ê¸°ë°˜ êµ¬í˜„ | 85% |
| **Supabase Backend** | ê³µê³µ API íŒŒì´í”„ë¼ì¸ | âš ï¸ LHë§Œ êµ¬í˜„ | 40% |
| **Design System** | Figma ê¸°ì¤€ ê³ ì • | âœ… íŒ¨í‚¤ì§€ ë¶„ë¦¬ | 100% |

---

## ğŸ” 2. ì„¸ë¶€ ê³„ì¸µë³„ ë¶„ì„

### 2.1 Flutter Mobile (`/apps/pickly_mobile/`)

#### âœ… ì¤€ìˆ˜ ì‚¬í•­
- **UI ë ˆì´ì–´ ë¶„ë¦¬**: `features/`ì™€ `contexts/`ê°€ ëª…í™•íˆ ë¶„ë¦¬ë¨
- **Freezed íŒ¨í„´**: ëª¨ë“  ëª¨ë¸ì— Freezed + JSON ì§ë ¬í™” ì ìš©
- **Riverpod 2.x**: Provider ê¸°ë°˜ ìƒíƒœ ê´€ë¦¬ êµ¬í˜„

#### âš ï¸ ë¬¸ì œì 

**1. `benefit` vs `benefits` í´ë” ì¤‘ë³µ**

```dart
// í˜„ì¬ ìƒíƒœ
features/
  â”œâ”€â”€ benefit/      # ì‹ ê·œ (announcement_detail_screen.dart)
  â””â”€â”€ benefits/     # ê¸°ì¡´ (benefits_screen.dart)
```

**ì›ì¸**: v8.0 ê°œë°œ ì¤‘ í´ë”ëª… ë³€ê²½ ê³¼ì •ì—ì„œ ë°œìƒ
**ì˜í–¥**: Flutter ì•±ì€ UI ë³€ê²½ ê¸ˆì§€ ì •ì±…ìœ¼ë¡œ ì¸í•´ í˜„ì¬ ìˆ˜ì • ë¶ˆê°€
**ëŒ€ì‘**: Repository Layerì—ì„œ ë‘ í´ë” ëª¨ë‘ ì§€ì›í•˜ë„ë¡ êµ¬í˜„

**2. Repository êµ¬ì¡°**

```dart
// âœ… í˜„ì¬ êµ¬ì¡° (PRD ì¤€ìˆ˜)
contexts/
  â””â”€â”€ benefit/
      â”œâ”€â”€ models/              # Freezed ëª¨ë¸
      â”œâ”€â”€ repositories/        # Supabase ì—°ë™
      â”‚   â”œâ”€â”€ benefit_repository.dart       # ì¹´í…Œê³ ë¦¬ + ê³µê³ 
      â”‚   â””â”€â”€ announcement_repository.dart  # ê³µê³  ì „ìš©
      â””â”€â”€ exceptions/          # ì—ëŸ¬ ì²˜ë¦¬
```

**ì¥ì **:
- Realtime Stream ì§€ì› (`watchAnnouncementsByCategory()`)
- View Count ìë™ ì¦ê°€ (`incrementViewCount()`)
- ê²€ìƒ‰ ìµœì í™” (`searchAnnouncements()`)

**ê°œì„  í•„ìš”**:
- íŒŒì¼ ì²¨ë¶€ ê¸°ëŠ¥ ë¯¸êµ¬í˜„ (`getFiles()` TODO)
- ë¶ë§ˆí¬/ì¦ê²¨ì°¾ê¸° ê¸°ëŠ¥ ì—†ìŒ

---

### 2.2 Admin (`/apps/pickly_admin/`)

#### âœ… êµ¬í˜„ ì™„ë£Œ ê¸°ëŠ¥

**1. í˜œíƒ ê´€ë¦¬ (BenefitCategoryPage)**
```tsx
// êµ¬í˜„ëœ ê¸°ëŠ¥
- íƒ­ë³„ ì¹´í…Œê³ ë¦¬ ê´€ë¦¬ (ì£¼ê±°/ì·¨ì—…/ê±´ê°•/êµìœ¡/ê¸ˆìœµ)
- CRUD ê¸°ëŠ¥ (AnnouncementTable)
- ë°°ë„ˆ ê´€ë¦¬ (MultiBannerManager)
- LH ê³µê³  ë¶ˆëŸ¬ì˜¤ê¸° (Edge Function ì—°ë™)
```

**2. API êµ¬ì¡° (`/src/api/`)**
```typescript
announcements.ts    // ê³µê³  CRUD + LH ì—°ë™
banners.ts         // ë°°ë„ˆ ê´€ë¦¬
benefits.ts        // í˜œíƒ ì¹´í…Œê³ ë¦¬
categories.ts      // ì¹´í…Œê³ ë¦¬ ê´€ë¦¬
users.ts          // ì‚¬ìš©ì ê´€ë¦¬
```

**3. Material UI ì»´í¬ë„ŒíŠ¸**
- `AnnouncementTable`: ì •ë ¬/í•„í„°ë§/ì¸ë¼ì¸ ìˆ˜ì •
- `MultiBannerManager`: ë“œë˜ê·¸ì•¤ë“œë¡­ ì •ë ¬
- `FileUploader`: S3 ì´ë¯¸ì§€ ì—…ë¡œë“œ
- `DynamicColumns`: ì»¬ëŸ¼ ë™ì  í† ê¸€

#### âš ï¸ ê°œì„  í•„ìš” ì‚¬í•­

**1. PRD v8.5 ìš”êµ¬ì‚¬í•­ ë¯¸êµ¬í˜„**

| í•­ëª© | í˜„ì¬ ìƒíƒœ | PRD ìš”êµ¬ì‚¬í•­ | ìš°ì„ ìˆœìœ„ |
|------|----------|-------------|----------|
| D-Day ê³„ì‚° | âŒ ë¯¸êµ¬í˜„ | `deadline_date` ê¸°ë°˜ ìë™ ê³„ì‚° | ğŸ”´ High |
| ì¡°íšŒìˆ˜ ì •ë ¬ | âš ï¸ ë°±ì—”ë“œë§Œ | Admin UIì—ì„œ ì •ë ¬ ê°€ëŠ¥í•´ì•¼ í•¨ | ğŸŸ¡ Medium |
| ì§€ì—­ í•„í„° | âŒ ë¯¸êµ¬í˜„ | `region` í•„ë“œ ê¸°ë°˜ í•„í„°ë§ | ğŸŸ¡ Medium |
| ìƒíƒœ í•„í„° í™•ì¥ | âš ï¸ ë¶€ë¶„ | ëª¨ì§‘ì¤‘/ë§ˆê°/ì˜ˆì •/ì´ˆì•ˆ 4ê°€ì§€ | ğŸŸ¢ Low |

**2. Edge Function ì—°ë™ ë¶€ì¡±**
- âœ… LH ê³µê³  ë¶ˆëŸ¬ì˜¤ê¸°ë§Œ êµ¬í˜„
- âŒ SH(ì„œìš¸ì£¼íƒë„ì‹œê³µì‚¬) ë¯¸êµ¬í˜„
- âŒ ë³µì§€ë¡œ(ë³´ê±´ë³µì§€ë¶€) ë¯¸êµ¬í˜„

---

### 2.3 Supabase Backend (`/backend/supabase/`)

#### âœ… DB ìŠ¤í‚¤ë§ˆ (v8.1 ê¸°ì¤€)

**1. í•µì‹¬ í…Œì´ë¸”**

```sql
-- announcements (í‘œì¤€í™”ëœ ê³µê³ )
CREATE TABLE announcements (
    id UUID PRIMARY KEY,
    title TEXT NOT NULL,
    subtitle TEXT,
    content TEXT,              -- âœ… v8.1 ì¶”ê°€
    category_id UUID REFERENCES benefit_categories(id),

    -- ìƒíƒœ ê´€ë¦¬
    status TEXT CHECK (status IN ('recruiting', 'closed', 'upcoming', 'draft')),
    is_home_visible BOOLEAN DEFAULT false,
    display_priority INTEGER DEFAULT 0,

    -- ë‚ ì§œ ì •ë³´
    deadline_date DATE,        -- âœ… v8.1 ì¶”ê°€ (D-Day ê³„ì‚°ìš©)
    application_start_date TIMESTAMPTZ,  -- âœ… v8.1 ì¶”ê°€
    application_end_date TIMESTAMPTZ,    -- âœ… v8.1 ì¶”ê°€

    -- ì¶”ê°€ ì •ë³´
    region TEXT,               -- âœ… v8.1 ì¶”ê°€
    tags JSONB,
    views_count INTEGER DEFAULT 0,
    search_vector tsvector,    -- âœ… ì „ë¬¸ ê²€ìƒ‰

    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- benefit_categories (ì¹´í…Œê³ ë¦¬)
CREATE TABLE benefit_categories (
    id UUID PRIMARY KEY,
    name TEXT NOT NULL,
    slug TEXT UNIQUE,          -- âœ… v8.1 ì¶”ê°€ (URLìš©)
    description TEXT,          -- âœ… v8.1 ì¶”ê°€
    icon_name TEXT,            -- âœ… v8.1 ì¶”ê°€
    parent_id UUID REFERENCES benefit_categories(id),
    display_order INTEGER,
    is_active BOOLEAN DEFAULT true
);

-- category_banners (ì¹´í…Œê³ ë¦¬ë³„ ë°°ë„ˆ)
CREATE TABLE category_banners (
    id UUID PRIMARY KEY,
    category_id UUID REFERENCES benefit_categories(id),
    image_url TEXT NOT NULL,
    title TEXT,
    subtitle TEXT,
    link_url TEXT,
    link_type TEXT,
    background_color TEXT DEFAULT '#FFFFFF',  -- âœ… v8.1 ì¶”ê°€
    display_order INTEGER,
    is_active BOOLEAN DEFAULT true
);
```

**2. ì¸ë±ìŠ¤ ìµœì í™”**

```sql
-- âœ… v8.1ì—ì„œ ì¶”ê°€ëœ ì„±ëŠ¥ ì¸ë±ìŠ¤
CREATE INDEX idx_announcements_region ON announcements(region);
CREATE INDEX idx_announcements_deadline ON announcements(deadline_date);
CREATE INDEX idx_announcements_home_display
    ON announcements(is_home_visible, display_priority);
CREATE INDEX idx_announcements_views ON announcements(views_count DESC);
```

**3. Realtime ë™ê¸°í™”**

```sql
-- âœ… ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ëŒ€ìƒ í…Œì´ë¸”
- announcements         â†’ ì•± í™ˆ/ë¦¬ìŠ¤íŠ¸ ìë™ ê°±ì‹ 
- category_banners      â†’ ì•± ë°°ë„ˆ ìë™ ê°±ì‹ 
- benefit_categories    â†’ ì•± í•„í„° ìë™ ê°±ì‹  (ì¬ì‹œì‘ í•„ìš”)
```

#### âš ï¸ ë¯¸êµ¬í˜„ ì‚¬í•­

**1. Edge Functions (ê³µê³µ API íŒŒì´í”„ë¼ì¸)**

```
í˜„ì¬:
functions/
  â””â”€â”€ fetch-lh-announcements/  âœ… LH ê³µê³  ìˆ˜ì§‘

í•„ìš”:
functions/
  â”œâ”€â”€ fetch-lh-announcements/   âœ… êµ¬í˜„ë¨
  â”œâ”€â”€ fetch-sh-announcements/   âŒ ë¯¸êµ¬í˜„ (ì„œìš¸ì£¼íƒ)
  â”œâ”€â”€ fetch-bokjiro-announcements/  âŒ ë¯¸êµ¬í˜„ (ë³µì§€ë¡œ)
  â””â”€â”€ transform-announcements/  âŒ ë¯¸êµ¬í˜„ (ë°ì´í„° ì •ì œ)
```

**2. DB Functions (RPC)**

```sql
-- âœ… êµ¬í˜„ë¨
increment_announcement_view_count(announcement_id UUID)

-- âŒ ë¯¸êµ¬í˜„ (PRD í•„ìš” ê¸°ëŠ¥)
calculate_deadline_status()        -- D-Day ìƒíƒœ ê³„ì‚°
get_popular_announcements()        -- ì¸ê¸° ê³µê³  ì¡°íšŒ
get_announcements_by_region()      -- ì§€ì—­ë³„ í•„í„°ë§
```

---

## ğŸ”„ 3. ë°ì´í„° íë¦„ ë¶„ì„

### 3.1 í˜„ì¬ íŒŒì´í”„ë¼ì¸

```
[ê³µê³µê¸°ê´€ API]
   â†“
[Supabase Edge Function]
   â†“ (í˜„ì¬ LHë§Œ)
[announcements_raw] (ì›ë³¸ ë°ì´í„°)
   â†“ (âš ï¸ transform í•¨ìˆ˜ ì—†ìŒ)
[announcements] (í‘œì¤€í™” ë°ì´í„°)
   â†“
[Admin CRUD] (ìˆ˜ì •/ë…¸ì¶œ ê´€ë¦¬)
   â†“
[Realtime Subscription]
   â†“
[Flutter Repository]
   â†“
[App UI í‘œì‹œ]
```

### 3.2 PRD v8.5 ìš”êµ¬ì‚¬í•­ê³¼ ë¹„êµ

| ë‹¨ê³„ | PRD ìš”êµ¬ì‚¬í•­ | í˜„ì¬ êµ¬í˜„ | ì°¨ì´ì  |
|------|-------------|----------|--------|
| **API ìˆ˜ì§‘** | LH/SH/ë³µì§€ë¡œ 3ê°œ | LHë§Œ | âŒ 2ê°œ ëˆ„ë½ |
| **ì›ë³¸ ì €ì¥** | `announcements_raw` | âœ… í…Œì´ë¸” ì¡´ì¬ | âœ… ì¤€ìˆ˜ |
| **ë°ì´í„° ì •ì œ** | `transform_announcements()` | âŒ í•¨ìˆ˜ ì—†ìŒ | âŒ ë¯¸êµ¬í˜„ |
| **í‘œì¤€í™”** | `announcements` | âœ… í…Œì´ë¸” ì¡´ì¬ | âœ… ì¤€ìˆ˜ |
| **Admin ìˆ˜ì •** | ì»¤ìŠ¤í„°ë§ˆì´ì§• í•„ë“œ | âš ï¸ ë¶€ë¶„ êµ¬í˜„ | âš ï¸ ì¼ë¶€ ëˆ„ë½ |
| **ì‹¤ì‹œê°„ ë™ê¸°í™”** | Realtime ì´ë²¤íŠ¸ | âœ… ìŠ¤íŠ¸ë¦¼ êµ¬í˜„ | âœ… ì¤€ìˆ˜ |

---

## ğŸ“‹ 4. PRD v8.5 ì²´í¬ë¦¬ìŠ¤íŠ¸

### 4.1 ë””ìì¸ & UI ì •ì±…

| í•­ëª© | ìƒíƒœ | ë¹„ê³  |
|------|------|------|
| Flutter UI ë³€ê²½ ê¸ˆì§€ | âœ… | `features/` ë¶„ë¦¬ ì™„ë£Œ |
| Design System ê³ ì • | âœ… | `pickly_design_system` íŒ¨í‚¤ì§€í™” |
| Figma ê¸°ì¤€ ìœ ì§€ | âœ… | ë””ìì¸ í† í° ì¼ì¹˜ |
| Admin Material UI | âœ… | MUI v5 ì‚¬ìš© ì¤‘ |

### 4.2 Repository Layer (ë²½)

| í•­ëª© | ìƒíƒœ | ë¹„ê³  |
|------|------|------|
| Repository Pattern êµ¬í˜„ | âœ… | `contexts/benefit/repositories/` |
| Realtime Stream ì§€ì› | âœ… | `watchAnnouncementsByCategory()` |
| ì—ëŸ¬ ì²˜ë¦¬ ë¶„ë¦¬ | âœ… | `exceptions/` íŒ¨í‚¤ì§€ |
| ê²€ìƒ‰ ìµœì í™” | âœ… | Full-text search êµ¬í˜„ |
| íŒŒì¼ ì²¨ë¶€ | âŒ | TODO ìƒíƒœ |

### 4.3 Admin ê¸°ëŠ¥

| í•­ëª© | ìƒíƒœ | ë¹„ê³  |
|------|------|------|
| í˜œíƒ ê´€ë¦¬ CRUD | âœ… | `BenefitCategoryPage` |
| ë°°ë„ˆ ê´€ë¦¬ | âœ… | `MultiBannerManager` |
| ì—°ë ¹ëŒ€ ê´€ë¦¬ | âŒ | UI ë¯¸êµ¬í˜„ |
| ê³µê³ ìœ í˜• ê´€ë¦¬ | âš ï¸ | ë°±ì—”ë“œë§Œ ì¡´ì¬ |
| D-Day ê³„ì‚° UI | âŒ | ë¯¸êµ¬í˜„ |
| ì¡°íšŒìˆ˜ ì •ë ¬ UI | âŒ | ë¯¸êµ¬í˜„ |
| ì§€ì—­ í•„í„° UI | âŒ | ë¯¸êµ¬í˜„ |

### 4.4 Supabase íŒŒì´í”„ë¼ì¸

| í•­ëª© | ìƒíƒœ | ë¹„ê³  |
|------|------|------|
| LH API ì—°ë™ | âœ… | `fetch-lh-announcements` |
| SH API ì—°ë™ | âŒ | Edge Function ë¯¸êµ¬í˜„ |
| ë³µì§€ë¡œ API ì—°ë™ | âŒ | Edge Function ë¯¸êµ¬í˜„ |
| ë°ì´í„° ì •ì œ í•¨ìˆ˜ | âŒ | `transform_announcements()` ì—†ìŒ |
| Realtime í™œì„±í™” | âœ… | Publication ì„¤ì •ë¨ |
| RPC í•¨ìˆ˜ | âš ï¸ | View Countë§Œ ì¡´ì¬ |

### 4.5 SSO ì¤€ë¹„ (í–¥í›„)

| í•­ëª© | ìƒíƒœ | ë¹„ê³  |
|------|------|------|
| Supabase Auth ì„¤ì • | âœ… | ì´ë©”ì¼ ì¸ì¦ ì‚¬ìš© ì¤‘ |
| OAuth Provider ì„¤ì • | âŒ | ì¹´ì¹´ì˜¤/ë„¤ì´ë²„ ë¯¸ì„¤ì • |
| Flutter ë¡œê·¸ì¸ UI | âš ï¸ | ì´ë©”ì¼ë§Œ ì§€ì› |
| Admin ê¶Œí•œ ë¶„ë¦¬ | âš ï¸ | RLS ì •ì±… ê¸°ë³¸ ì„¤ì • |

---

## ğŸš¨ 5. ì£¼ìš” ë¬¸ì œì  ë° ê¶Œì¥ ì‚¬í•­

### 5.1 ê¸´ê¸‰ ì¡°ì¹˜ í•„ìš” (High Priority)

#### 1ï¸âƒ£ `benefit` vs `benefits` í´ë” ì¤‘ë³µ í•´ì†Œ

**ë¬¸ì œ**:
```dart
features/
  â”œâ”€â”€ benefit/    # ì‹ ê·œ í´ë” (ìƒì„¸ í™”ë©´)
  â””â”€â”€ benefits/   # ê¸°ì¡´ í´ë” (ë¦¬ìŠ¤íŠ¸ í™”ë©´)
```

**í•´ê²° ë°©ì•ˆ**:
```dart
// Option A: Repositoryì—ì„œ ë‘ í´ë” ëª¨ë‘ ì§€ì›
contexts/benefit/repositories/
  â”œâ”€â”€ benefit_repository.dart        # ê³µí†µ ë¡œì§
  â”œâ”€â”€ detail_repository.dart         # ìƒì„¸ í™”ë©´ìš©
  â””â”€â”€ list_repository.dart           # ë¦¬ìŠ¤íŠ¸ í™”ë©´ìš©

// Option B: v9.0 ë””ìì¸ ë¦¬ë‰´ì–¼ ì‹œ í†µí•©
// í˜„ì¬ëŠ” PRD ì •ì±…ìƒ UI ìˆ˜ì • ë¶ˆê°€
```

**ê¶Œì¥**: Option A ì±„íƒ (UI ë³€ê²½ ì—†ì´ Repositoryë§Œ ë³´ê°•)

#### 2ï¸âƒ£ D-Day ê³„ì‚° ê¸°ëŠ¥ ì¶”ê°€

**í•„ìš”í•œ ì‘ì—…**:

```sql
-- 1. RPC í•¨ìˆ˜ ìƒì„±
CREATE OR REPLACE FUNCTION calculate_deadline_days(announcement_id UUID)
RETURNS INTEGER AS $$
DECLARE
    deadline DATE;
    today DATE;
BEGIN
    SELECT deadline_date INTO deadline
    FROM announcements
    WHERE id = announcement_id;

    IF deadline IS NULL THEN
        RETURN NULL;
    END IF;

    today := CURRENT_DATE;
    RETURN (deadline - today);
END;
$$ LANGUAGE plpgsql;
```

```tsx
// 2. Admin UI ì¶”ê°€
export function AnnouncementRow({ announcement }) {
    const dDays = useMemo(() => {
        if (!announcement.deadline_date) return null;
        const today = new Date();
        const deadline = new Date(announcement.deadline_date);
        const diff = Math.ceil((deadline - today) / (1000 * 60 * 60 * 24));
        return diff;
    }, [announcement.deadline_date]);

    return (
        <TableRow>
            <TableCell>
                {dDays !== null && (
                    <Chip
                        label={`D-${dDays}`}
                        color={dDays <= 7 ? 'error' : 'default'}
                    />
                )}
            </TableCell>
        </TableRow>
    );
}
```

```dart
// 3. Flutter Repository ì—…ë°ì´íŠ¸
class Announcement {
    int? get daysRemaining {
        if (deadlineDate == null) return null;
        final today = DateTime.now();
        return deadlineDate!.difference(today).inDays;
    }

    String get deadlineStatus {
        final days = daysRemaining;
        if (days == null) return 'ìƒì‹œëª¨ì§‘';
        if (days < 0) return 'ë§ˆê°';
        if (days == 0) return 'ì˜¤ëŠ˜ ë§ˆê°';
        if (days <= 7) return 'D-$days';
        return 'ëª¨ì§‘ì¤‘';
    }
}
```

#### 3ï¸âƒ£ Edge Function í™•ì¥ (SH, ë³µì§€ë¡œ)

**í˜„ì¬**:
```
functions/
  â””â”€â”€ fetch-lh-announcements/  âœ…
```

**í•„ìš”**:
```typescript
// functions/fetch-sh-announcements/index.ts
import { serve } from "https://deno.land/std@0.168.0/http/server.ts";
import { createClient } from '@supabase/supabase-js';

serve(async (req) => {
    const supabase = createClient(
        Deno.env.get('SUPABASE_URL')!,
        Deno.env.get('SUPABASE_SERVICE_ROLE_KEY')!
    );

    // SH ê³µì‚¬ API í˜¸ì¶œ
    const response = await fetch('https://api.seoul.go.kr/...', {
        headers: { 'Authorization': `Bearer ${Deno.env.get('SH_API_KEY')}` }
    });

    const announcements = await response.json();

    // announcements_rawì— ì €ì¥
    const { error } = await supabase
        .from('announcements_raw')
        .insert(announcements.map(a => ({
            source: 'SH',
            raw_data: a,
            created_at: new Date().toISOString()
        })));

    return new Response(JSON.stringify({ success: !error }), {
        headers: { 'Content-Type': 'application/json' }
    });
});
```

---

### 5.2 ì¤‘ìš” ê°œì„  ì‚¬í•­ (Medium Priority)

#### 4ï¸âƒ£ ì¡°íšŒìˆ˜/ì§€ì—­ í•„í„°ë§ UI ì¶”ê°€

```tsx
// Admin: ì¡°íšŒìˆ˜ ì •ë ¬
export function AnnouncementTable({ categoryId }) {
    const [orderBy, setOrderBy] = useState<'created_at' | 'views_count'>('created_at');

    const { data: announcements } = useQuery({
        queryKey: ['announcements', categoryId, orderBy],
        queryFn: async () => {
            const { data } = await supabase
                .from('announcements')
                .select('*')
                .eq('category_id', categoryId)
                .order(orderBy, { ascending: false });
            return data;
        }
    });

    return (
        <Box>
            <ToggleButtonGroup value={orderBy} onChange={(_, v) => setOrderBy(v)}>
                <ToggleButton value="created_at">ìµœì‹ ìˆœ</ToggleButton>
                <ToggleButton value="views_count">ì¸ê¸°ìˆœ</ToggleButton>
            </ToggleButtonGroup>
            {/* Table... */}
        </Box>
    );
}

// Admin: ì§€ì—­ í•„í„°
export function RegionFilter({ value, onChange }) {
    const regions = ['ì „ì²´', 'ì„œìš¸', 'ê²½ê¸°', 'ì¸ì²œ', 'ë¶€ì‚°', ...];

    return (
        <Select value={value} onChange={onChange}>
            {regions.map(r => <MenuItem value={r}>{r}</MenuItem>)}
        </Select>
    );
}
```

#### 5ï¸âƒ£ íŒŒì¼ ì²¨ë¶€ ê¸°ëŠ¥ êµ¬í˜„

```sql
-- 1. announcement_files í…Œì´ë¸” ìƒì„±
CREATE TABLE announcement_files (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    announcement_id UUID REFERENCES announcements(id) ON DELETE CASCADE,
    file_name TEXT NOT NULL,
    file_path TEXT NOT NULL,
    file_size INTEGER,
    file_type TEXT,
    display_order INTEGER DEFAULT 0,
    created_at TIMESTAMPTZ DEFAULT NOW()
);
```

```dart
// 2. Flutter Repository ì—…ë°ì´íŠ¸
Future<List<AnnouncementFile>> getFiles(String announcementId) async {
    try {
        final response = await _client
            .from('announcement_files')
            .select()
            .eq('announcement_id', announcementId)
            .order('display_order', ascending: true);

        return (response as List)
            .map((json) => AnnouncementFile.fromJson(json))
            .toList();
    } catch (e) {
        throw AnnouncementException(e.toString());
    }
}

Future<String> getFileUrl(String fileId) async {
    final fileRecord = await _client
        .from('announcement_files')
        .select('file_path')
        .eq('id', fileId)
        .single();

    final signedUrl = await _client.storage
        .from('announcement-files')
        .createSignedUrl(fileRecord['file_path'], 3600);

    return signedUrl;
}
```

---

### 5.3 ì¥ê¸° ê°œì„  ì‚¬í•­ (Low Priority)

#### 6ï¸âƒ£ ì—°ë ¹ëŒ€/ê³µê³ ìœ í˜• ê´€ë¦¬ Admin UI

```tsx
// pages/age-categories/AgeCategoriesPage.tsx
export function AgeCategoriesPage() {
    const { data: categories } = useQuery({
        queryKey: ['age-categories'],
        queryFn: async () => {
            const { data } = await supabase
                .from('age_categories')
                .select('*')
                .order('sort_order');
            return data;
        }
    });

    return (
        <DataGrid
            rows={categories}
            columns={[
                { field: 'name', headerName: 'ì—°ë ¹ëŒ€ëª…' },
                { field: 'min_age', headerName: 'ìµœì†Œ ë‚˜ì´' },
                { field: 'max_age', headerName: 'ìµœëŒ€ ë‚˜ì´' },
                { field: 'icon_url', headerName: 'ì•„ì´ì½˜', renderCell: ... },
                { field: 'is_active', headerName: 'í™œì„±í™”', type: 'boolean' }
            ]}
        />
    );
}
```

#### 7ï¸âƒ£ SSO ì¤€ë¹„ (v9.0)

```typescript
// lib/supabase.ts
export const supabase = createClient(
    process.env.VITE_SUPABASE_URL!,
    process.env.VITE_SUPABASE_ANON_KEY!,
    {
        auth: {
            providers: ['kakao', 'naver'], // í–¥í›„ ì¶”ê°€
            redirectTo: window.location.origin
        }
    }
);

// ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ë²„íŠ¼
async function signInWithKakao() {
    const { error } = await supabase.auth.signInWithOAuth({
        provider: 'kakao',
        options: {
            redirectTo: `${window.location.origin}/auth/callback`
        }
    });
}
```

---

## ğŸ“Š 6. ê°œë°œ ë¡œë“œë§µ ì œì•ˆ

### Phase 1: ê¸´ê¸‰ ë²„ê·¸ ìˆ˜ì • (1-2ì£¼)
- [ ] `benefit` vs `benefits` í´ë” Repository í†µí•©
- [ ] D-Day ê³„ì‚° RPC í•¨ìˆ˜ ìƒì„±
- [ ] Admin UIì— D-Day í‘œì‹œ ì¶”ê°€

### Phase 2: í•µì‹¬ ê¸°ëŠ¥ ì™„ì„± (2-3ì£¼)
- [ ] SH ê³µê³  Edge Function êµ¬í˜„
- [ ] ë³µì§€ë¡œ Edge Function êµ¬í˜„
- [ ] `transform_announcements()` SQL í•¨ìˆ˜
- [ ] ì¡°íšŒìˆ˜/ì§€ì—­ í•„í„°ë§ UI

### Phase 3: UX ê°œì„  (2-3ì£¼)
- [ ] íŒŒì¼ ì²¨ë¶€ ê¸°ëŠ¥ êµ¬í˜„
- [ ] ì—°ë ¹ëŒ€ ê´€ë¦¬ Admin UI
- [ ] ê³µê³ ìœ í˜• ê´€ë¦¬ Admin UI
- [ ] ë°°ë„ˆ ë“œë˜ê·¸ì•¤ë“œë¡­ ê°œì„ 

### Phase 4: ì¤€ë¹„ ì‘ì—… (1-2ì£¼)
- [ ] SSO OAuth ì„¤ì • (Supabase)
- [ ] RLS ì •ì±… ê°•í™”
- [ ] ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ

---

## âœ… 7. ê²°ë¡ 

### 7.1 ì¢…í•© í‰ê°€

**í˜„ì¬ ìƒíƒœ**: PRD v8.5 Master Finalì˜ í•µì‹¬ ì›ì¹™ì€ ì¤€ìˆ˜í•˜ê³  ìˆìœ¼ë‚˜, ì„¸ë¶€ ê¸°ëŠ¥ êµ¬í˜„ì´ ë¶€ì¡±í•œ ìƒíƒœ

**ì¤€ìˆ˜ìœ¨**:
- âœ… ì•„í‚¤í…ì²˜ ë¶„ë¦¬: 95% (benefit/benefits ì¤‘ë³µ ì œì™¸)
- âš ï¸ Admin ê¸°ëŠ¥: 60% (CRUDëŠ” ì™„ì„±, ì„¸ë¶€ í•„í„°/ì •ë ¬ ë¶€ì¡±)
- âš ï¸ Supabase íŒŒì´í”„ë¼ì¸: 40% (LHë§Œ êµ¬í˜„)
- âœ… Realtime ë™ê¸°í™”: 90% (ìŠ¤íŠ¸ë¦¼ êµ¬í˜„ ì™„ë£Œ)

### 7.2 í•µì‹¬ ê¶Œì¥ ì‚¬í•­

1. **UI ë³€ê²½ ê¸ˆì§€ ì •ì±… ìœ ì§€**: PRD v8.5 ì›ì¹™ëŒ€ë¡œ Flutter UIëŠ” ì ˆëŒ€ ê±´ë“œë¦¬ì§€ ë§ ê²ƒ
2. **Repository ì¤‘ì‹¬ ê°œë°œ**: ë°ì´í„° ë¡œì§ì€ ëª¨ë‘ `contexts/` ë‚´ë¶€ì—ì„œ ì²˜ë¦¬
3. **Admin ìš°ì„  ê°œë°œ**: ì‚¬ìš©ì ê¸°ëŠ¥ë³´ë‹¤ ê´€ë¦¬ ê¸°ëŠ¥ ì™„ì„±ë„ë¥¼ ë†’ì¼ ê²ƒ
4. **Edge Function í™•ì¥**: SH, ë³µì§€ë¡œ API ì—°ë™ì„ ìµœìš°ì„  ê³¼ì œë¡œ

### 7.3 ë‹¤ìŒ ë‹¨ê³„

```bash
# 1. ê¸´ê¸‰ ìˆ˜ì • ë¸Œëœì¹˜ ìƒì„±
git checkout -b fix/v8.5-critical-fixes

# 2. D-Day ê³„ì‚° ê¸°ëŠ¥ ì¶”ê°€
# - RPC í•¨ìˆ˜ ìƒì„±
# - Admin UI ì—…ë°ì´íŠ¸
# - Flutter Repository ì—°ë™

# 3. Edge Function í™•ì¥
# - fetch-sh-announcements êµ¬í˜„
# - fetch-bokjiro-announcements êµ¬í˜„
# - transform_announcements SQL í•¨ìˆ˜

# 4. PR ìƒì„± ë° ë¦¬ë·°
# - ì œëª©: "fix: PRD v8.5 critical compliance fixes"
# - ë¼ë²¨: priority:high, area:backend
```

---

## ğŸ“š ì°¸ê³  ë¬¸ì„œ

- [PRD v8.5 Master Final](/docs/prd/PRD_v8.5_Master_Final.md)
- [Admin Development Guide](/docs/prd/admin-development-guide.md)
- [Supabase Migration v8.1](/backend/supabase/migrations/20251030000003_prd_v8_1_sync.sql)
- [Flutter Repository Pattern](/apps/pickly_mobile/lib/contexts/benefit/repositories/benefit_repository.dart)

---

**ì‘ì„±ì**: Claude Code Agent
**ìµœì¢… ìˆ˜ì •**: 2025-10-31
**ë²„ì „**: v8.5 Analysis Report v1.0
