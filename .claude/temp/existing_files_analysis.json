{
  "analysis_timestamp": "2025-10-10T16:26:00Z",
  "project_root": "/Users/kwonhyunjun/Desktop/pickly_service",

  "existing_files": {
    "screens": [
      {
        "path": "apps/pickly_mobile/lib/features/onboarding/screens/age_category_screen.dart",
        "status": "EXISTS - UPDATE mode",
        "type": "screen",
        "lines": 288,
        "purpose": "Age category selection screen (Step 3/5), single selection mode",
        "state_management": "StatefulWidget with local state",
        "has_supabase": false,
        "notes": "Contains TODO comments for Supabase integration"
      },
      {
        "path": "apps/pickly_mobile/lib/features/onboarding/screens/age_category_screen_example.dart",
        "status": "EXISTS - Example file, can be removed",
        "type": "example"
      }
    ],

    "widgets": [
      {
        "path": "apps/pickly_mobile/lib/features/onboarding/widgets/onboarding_header.dart",
        "status": "EXISTS",
        "type": "widget",
        "component": "OnboardingHeader",
        "features": ["progress_indicator", "accessibility", "responsive"]
      },
      {
        "path": "apps/pickly_mobile/lib/features/onboarding/widgets/selection_card.dart",
        "status": "EXISTS",
        "type": "widget",
        "component": "SelectionCard",
        "features": ["icon_support", "svg_support", "animations", "multiple_selection", "accessibility"]
      },
      {
        "path": "apps/pickly_mobile/lib/features/onboarding/widgets/next_button.dart",
        "status": "EXISTS",
        "type": "widget",
        "component": "NextButton",
        "features": ["loading_state", "enabled_disabled", "safe_area", "accessibility"]
      },
      {
        "path": "apps/pickly_mobile/lib/features/onboarding/widgets/widgets.dart",
        "status": "EXISTS - Export file",
        "type": "barrel_export"
      }
    ],

    "providers": [
      {
        "path": "apps/pickly_mobile/lib/features/onboarding/providers/age_category_provider.dart",
        "status": "EXISTS",
        "type": "provider",
        "framework": "flutter_riverpod",
        "pattern": "AsyncNotifier",
        "features": ["realtime_subscription", "error_handling", "auto_dispose"],
        "dependencies": ["supabase_flutter", "flutter_riverpod"]
      },
      {
        "path": "apps/pickly_mobile/lib/features/onboarding/providers/age_category_controller.dart",
        "status": "EXISTS",
        "type": "provider"
      },
      {
        "path": "apps/pickly_mobile/lib/features/onboarding/providers/age_category_selection_provider.dart",
        "status": "EXISTS",
        "type": "provider"
      }
    ],

    "models": [
      {
        "path": "apps/pickly_mobile/lib/models/age_category.dart",
        "status": "EXISTS",
        "type": "model",
        "class": "AgeCategory",
        "features": ["fromJson", "toJson", "copyWith", "equality", "immutable"],
        "fields": ["id", "title", "description", "iconComponent", "iconUrl", "minAge", "maxAge", "sortOrder", "isActive", "createdAt", "updatedAt"]
      },
      {
        "path": "apps/pickly_mobile/lib/core/models/age_category.dart",
        "status": "EXISTS - Duplicate location",
        "notes": "Same model exists in two locations, should consolidate"
      }
    ],

    "repositories": [
      {
        "path": "apps/pickly_mobile/lib/repositories/age_category_repository.dart",
        "status": "EXISTS",
        "type": "repository",
        "class": "AgeCategoryRepository",
        "methods": ["fetchActiveCategories", "fetchCategoryById", "subscribeToCategories", "validateCategoryIds"],
        "features": ["realtime_subscription", "error_handling", "validation"]
      }
    ],

    "core_services": [
      {
        "path": "apps/pickly_mobile/lib/core/services/supabase_service.dart",
        "status": "EXISTS",
        "type": "service",
        "pattern": "singleton",
        "features": ["auth_management", "client_access"]
      }
    ],

    "design_system": [
      {
        "path": "packages/pickly_design_system/lib/pickly_design_system.dart",
        "status": "EXISTS - Main export",
        "type": "barrel_export"
      },
      {
        "path": "packages/pickly_design_system/lib/tokens/design_tokens.dart",
        "status": "EXISTS",
        "type": "tokens",
        "exports": ["colors", "typography", "spacing", "borders", "shadows", "animations"]
      },
      {
        "path": "packages/pickly_design_system/lib/widgets/buttons/pickly_button.dart",
        "status": "EXISTS",
        "component": "PicklyButton.primary"
      },
      {
        "path": "packages/pickly_design_system/lib/widgets/cards/list_card.dart",
        "status": "EXISTS",
        "component": "ListCard"
      },
      {
        "path": "packages/pickly_design_system/lib/widgets/indicators/progress_bar.dart",
        "status": "EXISTS",
        "component": "PicklyProgressBar"
      }
    ],

    "database": [
      {
        "path": "supabase/migrations/20251007035747_onboarding_schema.sql",
        "status": "EXISTS",
        "type": "migration",
        "tables": ["user_profiles", "age_categories"],
        "features": ["RLS_policies", "triggers", "initial_data"]
      },
      {
        "path": "supabase/migrations/20251007999999_update_icon_urls.sql",
        "status": "EXISTS",
        "type": "migration",
        "purpose": "Update icon URLs"
      }
    ]
  },

  "missing_files": {
    "theme": [
      {
        "path": "apps/pickly_mobile/lib/core/theme/*.dart",
        "status": "MISSING - CREATE mode",
        "reason": "No theme files found in core/theme directory",
        "recommendation": "Theme is in design_system package, no need to create"
      }
    ]
  },

  "patterns": {
    "imports": {
      "design_system": "import 'package:pickly_design_system/pickly_design_system.dart';",
      "flutter_riverpod": "import 'package:flutter_riverpod/flutter_riverpod.dart';",
      "supabase": "import 'package:supabase_flutter/supabase_flutter.dart';",
      "models": "import '../../../core/models/age_category.dart';",
      "services": "import '../../../core/services/supabase_service.dart';",
      "widgets": "import 'package:flutter/material.dart';"
    },

    "state_management": {
      "framework": "flutter_riverpod",
      "pattern": "AsyncNotifier + Provider",
      "example": "AsyncNotifierProvider<AgeCategoryNotifier, List<AgeCategory>>",
      "features": [
        "AsyncValue for loading/error/data states",
        "Auto-dispose with ref.onDispose",
        "Realtime subscription management",
        "Derived providers for convenience"
      ]
    },

    "styling": {
      "source": "pickly_design_system package",
      "tokens": {
        "colors": ["BrandColors", "BackgroundColors", "TextColors", "BorderColors", "StateColors", "SurfaceColors", "ButtonColors", "ChipColors"],
        "typography": "PicklyTypography",
        "spacing": "Spacing (xs, sm, md, lg, xl, xxl)",
        "borders": "PicklyBorderRadius",
        "shadows": "PicklyShadows",
        "animations": "PicklyAnimations"
      },
      "components": [
        "PicklyButton.primary",
        "PicklyProgressBar",
        "ListCard",
        "SelectionCard",
        "NextButton"
      ]
    },

    "error_handling": {
      "pattern": "Custom exception classes",
      "example": "AgeCategoryException",
      "features": ["message", "code", "details", "toString override"]
    },

    "database_patterns": {
      "supabase_tables": {
        "age_categories": {
          "columns": ["id", "title", "description", "icon_component", "icon_url", "min_age", "max_age", "sort_order", "is_active", "created_at", "updated_at"],
          "rls": "Anyone views active categories, Admins manage"
        },
        "user_profiles": {
          "onboarding_fields": ["selected_categories (UUID[])", "onboarding_completed", "onboarding_step"],
          "rls": "Users manage own profile"
        }
      },
      "realtime": {
        "pattern": "RealtimeChannel with PostgresChanges",
        "events": ["INSERT", "UPDATE", "DELETE"],
        "cleanup": "ref.onDispose(() => channel.unsubscribe())"
      }
    },

    "architecture": {
      "layers": [
        "Presentation (screens, widgets)",
        "State Management (providers)",
        "Domain (models)",
        "Data (repositories)",
        "Services (supabase_service)"
      ],
      "pattern": "Feature-first structure",
      "separation": "Design system as separate package"
    }
  },

  "coding_conventions": {
    "documentation": "Comprehensive dartdoc comments with examples",
    "immutability": "Use @immutable annotation and const constructors",
    "null_safety": "Sound null safety with proper ? and ! operators",
    "widgets": {
      "stateful_vs_stateless": "Use StatefulWidget for local state, Riverpod for shared state",
      "lifecycle": "Proper dispose in initState/dispose",
      "accessibility": "Semantics wrapper for all interactive widgets"
    },
    "naming": {
      "private": "Leading underscore (_buildContent, _isLoading)",
      "files": "snake_case (age_category_screen.dart)",
      "classes": "PascalCase (AgeCategoryScreen)",
      "variables": "camelCase (_selectedCategory)",
      "constants": "camelCase with const (const Duration)"
    }
  },

  "integration_points": {
    "supabase": {
      "initialization": "SupabaseService.initialize() in main.dart",
      "client_access": "ref.read(supabaseServiceProvider)",
      "realtime": "channel.onPostgresChanges",
      "auth": "SupabaseService.instance.currentUserId"
    },
    "navigation": {
      "pattern": "Navigator.of(context).pushNamed",
      "routes": "/onboarding/001-personal, /onboarding/002-region, etc.",
      "guards": "Check mounted before navigation"
    },
    "error_display": {
      "no_toast": "Requirement: No toast messages",
      "pattern": "Inline error text with error state",
      "retry": "Retry button in error UI"
    }
  },

  "recommendations": [
    {
      "priority": "high",
      "category": "code_duplication",
      "issue": "age_category.dart exists in both /models and /core/models",
      "action": "Consolidate to /core/models/age_category.dart and update imports"
    },
    {
      "priority": "medium",
      "category": "supabase_integration",
      "issue": "age_category_screen.dart has TODO comments for Supabase",
      "action": "Integrate with existing providers (age_category_provider.dart)"
    },
    {
      "priority": "medium",
      "category": "file_cleanup",
      "issue": "age_category_screen_example.dart is example file",
      "action": "Remove or move to examples directory"
    },
    {
      "priority": "low",
      "category": "documentation",
      "issue": "Widgets have excellent documentation",
      "action": "Maintain this standard for new files"
    },
    {
      "priority": "high",
      "category": "reusability",
      "issue": "Excellent reusable widget structure",
      "action": "Use SelectionCard, ListCard, NextButton, OnboardingHeader in new screens"
    }
  ],

  "next_steps_for_other_agents": {
    "coder": {
      "mode": "UPDATE existing files, CREATE new screens only",
      "use_existing_widgets": [
        "OnboardingHeader (progress indicator)",
        "SelectionCard (grid selection with icons)",
        "ListCard (list selection with icons)",
        "NextButton (bottom CTA)",
        "PicklyButton.primary (inline buttons)"
      ],
      "use_existing_providers": [
        "AgeCategoryProvider (for age categories data)",
        "SupabaseServiceProvider (for database access)"
      ],
      "follow_patterns": {
        "imports": "Use design system, riverpod, models from core",
        "state": "Riverpod AsyncNotifier for async data, StatefulWidget for local UI state",
        "styling": "Use design tokens from pickly_design_system",
        "errors": "Inline error UI, no toasts",
        "realtime": "Supabase realtime with proper cleanup"
      }
    },
    "tester": {
      "existing_tests": "Check test/ directory for existing test patterns",
      "test_files": [
        "test/features/onboarding/",
        "test/models/",
        "test/repositories/"
      ],
      "test_providers": "Use ProviderContainer for Riverpod testing"
    },
    "reviewer": {
      "check_consistency": [
        "Import patterns match existing files",
        "State management uses Riverpod correctly",
        "Design tokens used from pickly_design_system",
        "Error handling follows AgeCategoryException pattern",
        "Documentation quality matches existing widgets"
      ]
    }
  },

  "summary": {
    "total_existing_files": 20,
    "files_need_update": 1,
    "files_can_reuse": 11,
    "architecture_quality": "excellent",
    "code_quality": "high",
    "documentation_quality": "excellent",
    "state_management_maturity": "mature",
    "design_system_adoption": "complete",
    "supabase_integration": "partial (needs completion in screens)"
  }
}
